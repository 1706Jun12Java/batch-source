CREATE TABLE USERS (
USER_ID INTEGER PRIMARY KEY,
USER_TYPE_ID INTEGER,
FIRSTNAME VARCHAR2(100) NOT NULL,
LASTNAME VARCHAR2(100) NOT NULL,
PHONE_NUM VARCHAR2(15),
EMAIL VARCHAR2(100)
);

CREATE TABLE USER_TYPE (
USER_TYPE_ID INTEGER PRIMARY KEY,
USER_TYPE_ACCESS VARCHAR2(20)
);

CREATE TABLE BANK_ACCOUNT (
BANK_ACCOUNT_ID NUMBER PRIMARY KEY,
CURRENT_BALANCE INTEGER
);

CREATE TABLE USERS_BANK_ACCOUNT(
USER_ID INTEGER,
BANK_ACCOUNT_ID INTEGER,
PRIMARY KEY (USER_ID,BANK_ACCOUNT_ID)
);


ALTER TABLE USERS 
ADD CONSTRAINT FK_USERTYPE FOREIGN KEY (USER_TYPE_ID)REFERENCES USER_TYPE(USER_TYPE_ID);

CREATE SEQUENCE SQ_USER_PK
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SQ_BANKACCOUNT_PK
START WITH 1
INCREMENT BY 1;

CREATE OR REPLACE TRIGGER TR_INSERT_USER
BEFORE INSERT ON USERS
FOR EACH ROW
BEGIN
SELECT SQ_USER_PK.NEXTVAL INTO :NEW.USER_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER TR_INSERT_BANK_ID
BEFORE INSERT ON BANK_ACCOUNT
FOR EACH ROW
BEGIN
SELECT SQ_BANKACCOUNT_PK.NEXTVAL INTO :NEW.BANK_ACCOUNT_ID FROM DUAL;
END;



INSERT INTO USER_TYPE VALUES (1,'REGISTERED');
INSERT INTO USER_TYPE VALUES (2,'NOT_REGISTERED');
INSERT INTO USER_TYPE VALUES (3,'SUPERUSER');

INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (3,'JOHN','SNOW','212-222-2323','JOHN.SNOW@THRONES.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (2,'BOB','THEBUILDER','646-212-2112','BUILDER@BOB.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'MR','SMITH','347-137-2000','MR.SMITH@GMAIL.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'MRS','SMITH','347-137-2001','MRS.SMITH@GMAIL.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'JACK','BLACK','347-836-0175','JACK.BLACK@GMAIL.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'WILL','SMITH','898-284-0257','WILL.SMITH@GMAIL.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'PHARAH','MERCY','347-925-1047','BESTCOMBO@OVERWATCH.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'GENJI','SHAMADA','101-351-7183','MADADA@OVERWATCH.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'HANZO','SHAMADA','101-653-0987','MADA@OVERWATCH.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'JESSE','MCCREE','212-861-3752','HIGHNOON@OVERWATCH.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'WILBERT','WILLIAMS','646-294-1029','WIL.W@GMAIL.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'HARRY','POTTER','678-282-1350','HARRYPOTTER@HOGWARTS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'RON','WEASLEY','678-135-2467','THE.GINGER@HOGWARTS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'HERMIONE','GRANGER','678-624-4638','THE.SMARTEST@HOGWARTS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'ALBUS','DUMBLEDORE','678-150-4145','HEADMASTER@HOGWARTS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'THE','BEAST','290-231-5731','BEAST@BB.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (2,'PRINCESS','BELLE','290-614-6833','P.BELLE@BB.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'SNOW','WHITE','751-428-1369','SNOW.WHITE@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'GRUMPY','STUFFY','751-483-9532','GRUMPY@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'SLEEPY','LAZY','751-967-1356','SLEEPY@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'DOC','DEAFY','751-437--9998','DOC@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'HAPPY','JUMPY','751-134-0098','HAPPY@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'BASHFUL','PUFFY','751-315-8383','BASHFUL@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'DOPEY','BURPY','751-112-5655','DOPEY@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (2,'SNEEZY','WHEEZY','751-499-1325','SNEEZY@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'PRINCE','CHARMING','751-006-1000','CHARMING@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'EVIL','QUEEN','751-999-9991','EVIL.QUEEN@ENCHANTEDFOREST.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'JACK','FROST','000-286-3596','FROSTJ@COLD.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'SANTA','CLAUSE','100-101-0011','MR.CLAUSE@NORTHPOLE.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'SUN','WUKONG','931-9495','GOKU@GODS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'HERCULES','GOFOFSTRENGTH',NULL,'HERC@GREEKS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'ARIES','GODOFWAR',NULL,'ILOVEWAR@GREEKS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'WHITE','SNOW',NULL,NULL);
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (2,'CLARK','KENT','917-539-7811','SUPERMAN@JUSTICELEAGUE.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'DIANA','PRINCE','917-437-1931','JOHN.SNOW@JUSTICELEAGUE.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'TONY','STARK','917-667-9310','ICANBUYANYTHING@AVENGERS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'BRUCE','BANNER','917-239-2068','DONOTGETMEMAD@AVENGERS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'PETER','PARKER','917-453-4896','WEBS@AVENGERS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (1,'ANT','MAN','917-444-1388','BIGORSMALL@AVENGERS.COM');
INSERT INTO USERS (USER_TYPE_ID,FIRSTNAME,LASTNAME,PHONE_NUM,EMAIL) VALUES (2,'GREEN','ARROW','917-907-0000','ARROWS@JUSTICELEAGUE.COM');

INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (481567);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (8900);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (500000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (28967);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (75000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (314890);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1132612);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (12234500);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (82571);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (23195);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (121212);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (678);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (28648162);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (87);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (10000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (345987);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (34481567);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (123422);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (4237);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (7);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (127);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (367);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (19);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (33);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (98);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (23);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (2346889);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (4689901);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1001);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1567);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (48123467);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (1);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (0);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (2839465);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (385613);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (100000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (238562);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (29347);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (9800);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (250000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (750000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (50000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (8747);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (238497322);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (3000000);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (2357928);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (23485);
INSERT INTO BANK_ACCOUNT (CURRENT_BALANCE) VALUES (235928);

INSERT INTO USERS_BANK_ACCOUNT VALUES (1,1);
INSERT INTO USERS_BANK_ACCOUNT VALUES (2,2);
INSERT INTO USERS_BANK_ACCOUNT VALUES (3,3);
INSERT INTO USERS_BANK_ACCOUNT VALUES (3,4);
INSERT INTO USERS_BANK_ACCOUNT VALUES (4,5);
INSERT INTO USERS_BANK_ACCOUNT VALUES (4,6);
INSERT INTO USERS_BANK_ACCOUNT VALUES (5,7);
INSERT INTO USERS_BANK_ACCOUNT VALUES (6,8);
INSERT INTO USERS_BANK_ACCOUNT VALUES (7,9);
INSERT INTO USERS_BANK_ACCOUNT VALUES (8,10);
INSERT INTO USERS_BANK_ACCOUNT VALUES (9,11);
INSERT INTO USERS_BANK_ACCOUNT VALUES (10,12);
INSERT INTO USERS_BANK_ACCOUNT VALUES (11,13);
INSERT INTO USERS_BANK_ACCOUNT VALUES (12,14);
INSERT INTO USERS_BANK_ACCOUNT VALUES (13,15);
INSERT INTO USERS_BANK_ACCOUNT VALUES (14,16);
INSERT INTO USERS_BANK_ACCOUNT VALUES (15,17);
INSERT INTO USERS_BANK_ACCOUNT VALUES (16,18);
INSERT INTO USERS_BANK_ACCOUNT VALUES (17,19);
INSERT INTO USERS_BANK_ACCOUNT VALUES (18,20);
INSERT INTO USERS_BANK_ACCOUNT VALUES (19,21);
INSERT INTO USERS_BANK_ACCOUNT VALUES (20,22);
INSERT INTO USERS_BANK_ACCOUNT VALUES (21,23);
INSERT INTO USERS_BANK_ACCOUNT VALUES (22,24);
INSERT INTO USERS_BANK_ACCOUNT VALUES (23,25);
INSERT INTO USERS_BANK_ACCOUNT VALUES (24,26);
INSERT INTO USERS_BANK_ACCOUNT VALUES (25,27);
INSERT INTO USERS_BANK_ACCOUNT VALUES (26,28);
INSERT INTO USERS_BANK_ACCOUNT VALUES (27,29);
INSERT INTO USERS_BANK_ACCOUNT VALUES (28,30);
INSERT INTO USERS_BANK_ACCOUNT VALUES (29,31);
INSERT INTO USERS_BANK_ACCOUNT VALUES (30,32);
INSERT INTO USERS_BANK_ACCOUNT VALUES (31,33);
INSERT INTO USERS_BANK_ACCOUNT VALUES (32,34);
INSERT INTO USERS_BANK_ACCOUNT VALUES (33,35);
INSERT INTO USERS_BANK_ACCOUNT VALUES (34,36);
INSERT INTO USERS_BANK_ACCOUNT VALUES (35,37);
INSERT INTO USERS_BANK_ACCOUNT VALUES (36,38);
INSERT INTO USERS_BANK_ACCOUNT VALUES (37,39);
INSERT INTO USERS_BANK_ACCOUNT VALUES (38,40);
INSERT INTO USERS_BANK_ACCOUNT VALUES (39,41);
INSERT INTO USERS_BANK_ACCOUNT VALUES (40,42);
INSERT INTO USERS_BANK_ACCOUNT VALUES (36,43);
INSERT INTO USERS_BANK_ACCOUNT VALUES (36,44);
INSERT INTO USERS_BANK_ACCOUNT VALUES (38,45);
INSERT INTO USERS_BANK_ACCOUNT VALUES (40,46);
INSERT INTO USERS_BANK_ACCOUNT VALUES (40,47);
INSERT INTO USERS_BANK_ACCOUNT VALUES (26,48);
INSERT INTO USERS_BANK_ACCOUNT VALUES (27,49);
INSERT INTO USERS_BANK_ACCOUNT VALUES (6,50);

CREATE OR REPLACE PROCEDURE DEPOSIT (U_ID INTEGER,BA_ID INTEGER,AMOUNT INTEGER)
IS
U_BA INTEGER;
BEGIN
SAVEPOINT S;
SELECT COUNT(USBA.USER_ID) INTO U_BA FROM USERS_BANK_ACCOUNT USBA
WHERE USBA.USER_ID = U_ID AND USBA.BANK_ACCOUNT_ID = BA_ID;
IF U_BA > 0 THEN
UPDATE BANK_ACCOUNT
SET CURRENT_BALANCE = CURRENT_BALANCE+AMOUNT
WHERE BANK_ACCOUNT_ID = BA_ID;
COMMIT;
ELSE
ROLLBACK TO SAVEPOINT S;
END IF;
END;

CREATE OR REPLACE PROCEDURE WITHDRAWL (U_ID INTEGER,BA_ID INTEGER,AMOUNT INTEGER)
IS
U_BA INTEGER;
BEGIN
SAVEPOINT S;
SELECT COUNT(USBA.USER_ID) INTO U_BA FROM USERS_BANK_ACCOUNT USBA
WHERE USBA.USER_ID = U_ID AND USBA.BANK_ACCOUNT_ID = BA_ID;
IF U_BA > 0 THEN
UPDATE BANK_ACCOUNT
SET CURRENT_BALANCE = CURRENT_BALANCE-AMOUNT
WHERE BANK_ACCOUNT_ID = BA_ID;
COMMIT;
ELSE
DBMS_OUTPUT.PUT_LINE('FAILED TO WITHDRAW');
ROLLBACK TO SAVEPOINT S;
END IF;
END;

--records transaction history
CREATE OR REPLACE TRIGGER TR_TRANSACTION_HISTORY
AFTER UPDATE ON BANK_ACCOUNT
FOR EACH ROW
DECLARE X VARCHAR2(40);
BEGIN
IF :OLD.CURRENT_BALANCE < :NEW.CURRENT_BALANCE THEN
DBMS_OUTPUT.PUT('A DEPOSIT OF $');
DBMS_OUTPUT.PUT(:NEW.CURRENT_BALANCE - :OLD.CURRENT_BALANCE);
DBMS_OUTPUT.PUT(' WAS TAKEN FROM YOUR ACCOUNT ON: ');
SELECT TO_CHAR(SYSDATE, 'MON-DD-YYYY HH:MI PM') INTO X FROM DUAL;
DBMS_OUTPUT.PUT_LINE(X);
DBMS_OUTPUT.PUT_LINE('CURRENT BALANCE IS NOW: ' || :NEW.CURRENT_BALANCE);
ELSE
DBMS_OUTPUT.PUT('A WITHDRAWL OF $');
DBMS_OUTPUT.PUT(:OLD.CURRENT_BALANCE - :NEW.CURRENT_BALANCE);
DBMS_OUTPUT.PUT(' WAS TAKEN FROM YOUR ACCOUNT ON: ');
SELECT TO_CHAR(SYSDATE, 'MON-DD-YYYY HH:MI AM') INTO X FROM DUAL;
DBMS_OUTPUT.PUT_LINE(X);
DBMS_OUTPUT.PUT_LINE('CURRENT BALANCE IS NOW: ' || :NEW.CURRENT_BALANCE);
END IF;
END;

BEGIN 
WITHDRAWL(1,1,100);
END;


